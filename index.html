<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Sport Lock</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; margin:20px; }
.circle { width: 150px; height: 150px; border-radius: 50%; border: 10px solid #ccc; margin: 20px auto; position: relative; }
.progress { position: absolute; top:0; left:0; width:100%; height:100%; border-radius: 50%; clip: rect(0px, 150px, 150px, 75px); background: #4caf50; transform: rotate(0deg); transform-origin: center center; }
.inner { width: 120px; height: 120px; background:#fff; border-radius:50%; position:absolute; top:15px; left:15px; line-height:120px; font-size:24px; }
button { margin: 5px; padding: 10px 20px; font-size: 16px; }
#status { margin-top: 20px; font-size: 18px; }
label { display:block; margin:5px 0; }
input { padding:5px; width:100px; }
</style>
</head>
<body>

<h1>Sport Lock</h1>

<div>
  <label>Objectif jour (km) :</label>
  <input type="number" id="dailyGoal" value="20">
  <label>Objectif semaine (km) :</label>
  <input type="number" id="weeklyGoal" value="80">
  <button onclick="saveGoals()">Enregistrer objectifs</button>
</div>

<div class="circle">
  <div class="progress" id="progress"></div>
  <div class="inner" id="percent">0%</div>
</div>

<div id="status">Sport non termin√© üîí</div>
<button onclick="unlockTV()">D√©bloquer TV</button>
<button onclick="lockTV()">Bloquer TV</button>

<script>
/* Stockage des objectifs */
function saveGoals() {
  const daily = parseFloat(document.getElementById('dailyGoal').value);
  const weekly = parseFloat(document.getElementById('weeklyGoal').value);
  localStorage.setItem("dailyGoal", daily);
  localStorage.setItem("weeklyGoal", weekly);
  alert("Objectifs enregistr√©s !");
  updateProgressFromWorker();
}

/* Boutons TV */
function unlockTV() { document.getElementById('status').textContent="TV d√©bloqu√©e ‚úÖ"; }
function lockTV() { document.getElementById('status').textContent="Sport non termin√© üîí"; }

/* Cercle */
function setProgress(percent) {
  const deg = percent*3.6;
  document.getElementById('progress').style.transform=`rotate(${deg}deg)`;
  document.getElementById('percent').textContent=percent+"%";
  if(percent>=100) document.getElementById('status').textContent="Sport termin√© ‚úÖ";
  else document.getElementById('status').textContent="Sport non termin√© üîí";
}

/* Fetch Worker Strava */
function updateProgressFromWorker() {
  const dailyGoal = parseFloat(localStorage.getItem("dailyGoal")) || 20;
  const weeklyGoal = parseFloat(localStorage.getItem("weeklyGoal")) || 80;
  fetch("https://sport-lock-strava.thomas-dutoyat.workers.dev/")
    .then(res => res.json())
    .then(data => {
      const percentDay = Math.min(Math.round((data.today/dailyGoal)*100),100);
      const percentWeek = Math.min(Math.round((data.week/weeklyGoal)*100),100);
      setProgress(percentDay);
      console.log("Pourcentage jour :", percentDay, "Pourcentage semaine :", percentWeek);
    })
    .catch(err => console.error("Erreur r√©cup√©ration donn√©es :", err));
}

/* Initialisation */
window.onload = function() {
  if(!localStorage.getItem("dailyGoal")) localStorage.setItem("dailyGoal", 20);
  if(!localStorage.getItem("weeklyGoal")) localStorage.setItem("weeklyGoal", 80);
  updateProgressFromWorker();
};
</script>

</body>
</html>
